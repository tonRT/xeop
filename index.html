<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CRIMSON x DEEPSEEK</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Pyodide (DeepSeek Engine) -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-deep: #030005;
            --deepseek-blue: #3b82f6;
            --crimson-red: #ff0033;
            --neon-purple: #a855f7;
            --card-bg: linear-gradient(145deg, #0a0105, #020002);
        }

        body {
            background-color: var(--bg-deep);
            color: #e0e0e0;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- DEEPSEEK ANIMATIONS --- */
        @keyframes neural-pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        @keyframes data-stream {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .deep-border {
            position: relative;
        }
        .deep-border::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, var(--crimson-red), var(--deepseek-blue), var(--crimson-red));
            background-size: 200% 200%;
            animation: data-stream 2s linear infinite;
        }

        /* CARD STYLES */
        .intel-card {
            background: var(--card-bg);
            border: 1px solid #2a0a1a;
            border-left: 4px solid var(--crimson-red);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        
        .intel-card.deep-mode {
            border-left-color: var(--deepseek-blue);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.1);
        }

        .reasoning-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 8px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-top: 1px solid #1f1f1f;
            margin-top: 8px;
            padding-top: 4px;
        }

        .profit-badge {
            background: rgba(59, 130, 246, 0.1);
            color: var(--deepseek-blue);
            border: 1px solid rgba(59, 130, 246, 0.3);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
        }

        /* HEADER */
        .cyber-header {
            position: sticky; top: 0; z-index: 50;
            background: rgba(3, 0, 5, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #222;
            padding: 10px;
        }

        .search-bar {
            width: 100%; background: #0c0508; border: 1px solid #331122;
            color: white; padding: 10px; font-family: 'Rajdhani', sans-serif;
            font-weight: 700; outline: none; border-radius: 4px;
            transition: 0.3s;
        }
        .search-bar:focus { border-color: var(--deepseek-blue); }

        /* LOADER */
        .brain-loader {
            width: 50px; height: 50px;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjIiPjxwYXRoIGQ9Ik05LjUgMmEyLjUgMi41IDAgMDxMIDE0LjUgMmEyLjUgMi41IDAgMDFDIi8+PC9zdmc+'); /* Simplified for demo */
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: var(--deepseek-blue);
            border-bottom-color: var(--crimson-red);
            animation: spin 1s infinite linear;
            margin: 0 auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-20">

    <!-- HEADER -->
    <div class="cyber-header deep-border">
        <div class="flex justify-between items-center mb-3">
            <h1 class="text-xl font-bold text-white font-[Orbitron]">
                CRIMSON <span class="text-blue-500 text-xs align-top">DEEPSEEK</span>
            </h1>
            <div class="flex items-center gap-2">
                <span class="text-[9px] text-gray-500 font-bold">INTELLIGENCE ACTIVE</span>
                <span class="w-2 h-2 rounded-full bg-blue-500" style="animation: neural-pulse 2s infinite"></span>
            </div>
        </div>
        
        <div class="relative">
            <input type="text" id="searchInput" class="search-bar" placeholder="SEARCH ASSET / USDT..." onkeyup="filterSignals()">
            <i class="fa-solid fa-microchip absolute right-3 top-3 text-blue-900"></i>
        </div>
    </div>

    <!-- FEED -->
    <div id="signal-feed" class="p-3 min-h-screen">
        <div id="loader" class="text-center mt-32">
            <div class="brain-loader mb-4"></div>
            <p class="text-xs text-blue-500 font-mono">LOADING DEEPSEEK MODELS...</p>
        </div>
    </div>

    <!-- NAV -->
    <div class="fixed bottom-0 w-full bg-[#030005] border-t border-[#222] flex justify-around py-3 z-50">
        <button class="flex flex-col items-center text-blue-500" onclick="location.reload()">
            <i class="fa-solid fa-brain text-lg"></i>
            <span class="text-[9px] mt-1">ANALYSIS</span>
        </button>
        <button class="flex flex-col items-center text-gray-600">
            <i class="fa-solid fa-chart-simple text-lg"></i>
            <span class="text-[9px] mt-1">MARKET</span>
        </button>
        <button class="flex flex-col items-center text-gray-600">
            <i class="fa-solid fa-newspaper text-lg"></i>
            <span class="text-[9px] mt-1">NEWS</span>
        </button>
    </div>

    <!-- DEEPSEEK LOGIC (PYTHON) -->
    <script type="text/javascript">
        const deepLogic = `
import json
import math

# --- CORE INDICATORS ---
def rsi(prices, period=14):
    if len(prices) < period + 1: return 50
    deltas = [prices[i+1] - prices[i] for i in range(len(prices)-1)]
    gains = [d if d > 0 else 0 for d in deltas]
    losses = [-d if d < 0 else 0 for d in deltas]
    avg_g = sum(gains[:period]) / period
    avg_l = sum(losses[:period]) / period
    if avg_l == 0: return 100
    rs = avg_g / avg_l
    return 100 - (100 / (1 + rs))

def ema(prices, period):
    if len(prices) < period: return 0
    k = 2 / (period + 1)
    ema = sum(prices[:period]) / period
    for p in prices[period:]:
        ema = (p * k) + (ema * (1 - k))
    return ema

def atr(prices, period=14):
    if len(prices) < period + 1: return 0
    tr_sum = 0
    for i in range(1, len(prices)):
        high = prices[i] # Simplified (Close as High approximation for demo)
        low = prices[i]
        prev_close = prices[i-1]
        # True Range simplified for Close-only data
        tr = abs(high - prev_close) 
        tr_sum += tr
    return tr_sum / period

# --- DEEPSEEK ANALYSIS ENGINE ---
def deep_analyze(symbol, prices_json):
    prices = json.loads(prices_json)
    if len(prices) < 60: return json.dumps({"valid": False})
    
    current = prices[-1]
    
    # 1. CALCULATE DEEP METRICS
    val_rsi = rsi(prices, 14)
    val_ema9 = ema(prices, 9)
    val_ema21 = ema(prices, 21)
    val_ema50 = ema(prices, 50)
    val_atr = atr(prices, 14)
    
    # Volatility Check (Is the market moving?)
    volatility = val_atr / current
    
    signal = "NONE"
    timeframe = "15M" # Default
    reason = "Scanning..."
    conf = 0
    
    # --- LOGIC LAYER: 70% BIAS TO 5M-15M ---
    
    # SETUP 1: 5M MOMENTUM (Scalp) - High Priority
    if val_ema9 > val_ema21 and val_rsi > 55 and val_rsi < 75:
        if volatility > 0.002: # Ensure enough movement
            signal = "LONG"
            timeframe = "5M"
            reason = "Vol. Spike + EMA Align"
            conf = 88
    elif val_ema9 < val_ema21 and val_rsi < 45 and val_rsi > 25:
        if volatility > 0.002:
            signal = "SHORT"
            timeframe = "5M"
            reason = "Vol. Spike + EMA Align"
            conf = 88

    # SETUP 2: 15M TREND (Swing) - Medium Priority
    # Only verify if 5M didn't trigger to allow overwriting with stronger signals
    if signal == "NONE":
        if current > val_ema21 and val_ema21 > val_ema50:
            signal = "LONG"
            timeframe = "15M"
            reason = "Trend Continuation Structure"
            conf = 85
        elif current < val_ema21 and val_ema21 < val_ema50:
            signal = "SHORT"
            timeframe = "15M"
            reason = "Trend Breakdown Structure"
            conf = 85

    # If still NONE, check simple oversold (30% remaining cases)
    if signal == "NONE":
        if val_rsi < 25: 
            signal = "LONG"; timeframe="REVERSAL"; reason="Deep Oversold (RSI < 25)"; conf=75
        elif val_rsi > 75:
            signal = "SHORT"; timeframe="REVERSAL"; reason="Deep Overbought (RSI > 75)"; conf=75

    if signal == "NONE": return json.dumps({"valid": False})

    # --- TARGET CALCULATION (30% PROFIT LOGIC) ---
    # At 20x Leverage, 30% Profit = 1.5% Price Move
    target_dist = 0.015 
    
    tp = current * (1 + target_dist) if signal == "LONG" else current * (1 - target_dist)
    sl = current * 0.99 if signal == "LONG" else current * 1.01 # 1% SL (Tight)
    
    return json.dumps({
        "valid": True,
        "symbol": symbol,
        "sig": signal,
        "tf": timeframe,
        "price": current,
        "tp": tp,
        "sl": sl,
        "conf": conf,
        "reason": reason,
        "vol": round(volatility * 1000, 2)
    })
`;
    </script>

    <!-- JS CONTROL -->
    <script>
        let pyodide = null;
        let marketData = [];
        let isScanning = false;

        window.onload = async () => {
            // Load Python
            pyodide = await loadPyodide();
            await pyodide.runPythonAsync(deepLogic);
            
            // Get Market
            await fetchMarket();
            
            // Start Loop
            runDeepScan();
        };

        async function fetchMarket() {
            try {
                // Fetch top 100 coins
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h');
                const data = await res.json();
                // Filter: 0.05 - 5.00 USDT
                marketData = data.filter(c => c.current_price >= 0.05 && c.current_price <= 5.00);
            } catch(e) {
                setTimeout(fetchMarket, 5000);
            }
        }

        async function runDeepScan() {
            if(marketData.length === 0) { setTimeout(runDeepScan, 1000); return; }
            if(isScanning) return;
            isScanning = true;

            // Remove Loader
            const loader = document.getElementById('loader');
            if(loader) loader.remove();

            // Pick 2 random assets
            const c1 = marketData[Math.floor(Math.random() * marketData.length)];
            const c2 = marketData[Math.floor(Math.random() * marketData.length)];
            
            await Promise.all([analyze(c1), analyze(c2)]);
            
            isScanning = false;
            setTimeout(runDeepScan, 2500); // Fast cycle
        }

        async function analyze(coin) {
            try {
                // Fetch 1 Day of 5m candles (Standard for Deep Analysis)
                const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coin.id}/market_chart?vs_currency=usd&days=1`);
                const json = await res.json();
                const prices = json.prices.map(p => p[1]);
                
                // DeepSeek Logic
                const pyRes = await pyodide.runPythonAsync(`deep_analyze('${coin.symbol.toUpperCase()}', '${JSON.stringify(prices)}')`);
                const data = JSON.parse(pyRes);
                
                if(data.valid) {
                    addCard(coin, data);
                }
            } catch(e) {}
        }

        function addCard(coin, data) {
            const feed = document.getElementById('signal-feed');
            
            // Deduplicate
            const old = document.getElementById(`card-${coin.id}`);
            if(old) old.remove();
            
            // Max 10 items
            if(feed.children.length >= 10) feed.lastElementChild.remove();
            
            const isLong = data.sig === "LONG";
            const color = isLong ? "text-blue-400" : "text-red-500";
            const borderClass = isLong ? "deep-mode" : "";
            
            const html = `
            <div id="card-${coin.id}" class="intel-card ${borderClass} opacity-0" style="animation: fadeUp 0.5s forwards">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <img src="${coin.image}" class="w-10 h-10 rounded border border-gray-800">
                        <div>
                            <div class="font-bold text-lg text-white font-[Orbitron]">${data.symbol}</div>
                            <div class="profit-badge mt-1">TARGET 30%</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-[9px] text-gray-400 font-bold mb-1">${data.tf} â€¢ CONF ${data.conf}%</div>
                        <div class="text-2xl font-black ${color} tracking-tight">${data.sig}</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 mt-3 bg-black/40 p-2 rounded border border-gray-800">
                    <div>
                        <span class="text-[9px] text-gray-500 font-bold">ENTRY</span>
                        <div class="text-sm font-mono text-white">$${data.price.toFixed(5)}</div>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] text-gray-500 font-bold">TARGET (1.5%)</span>
                        <div class="text-sm font-mono ${color} font-bold">$${data.tp.toFixed(5)}</div>
                    </div>
                </div>

                <div class="reasoning-text">
                    <i class="fa-solid fa-microchip mr-1"></i> DEEPSEEK CORE: ${data.reason}
                </div>
            </div>
            <style>@keyframes fadeUp { to { opacity: 1; transform: translateY(0); } from { opacity: 0; transform: translateY(20px); } }</style>
            `;
            
            feed.insertAdjacentHTML('afterbegin', html);
        }

        function filterSignals() {
            const val = document.getElementById('searchInput').value.toUpperCase();
            document.querySelectorAll('.intel-card').forEach(c => {
                c.style.display = c.innerText.toUpperCase().includes(val) ? 'block' : 'none';
            });
        }
    </script>
</body>
</html>


